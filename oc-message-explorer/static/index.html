<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OC Message Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-hover: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent: #58a6ff;
            --accent-hover: #79c0ff;
            --border: #30363d;
            --success: #238636;
            --danger: #da3633;
            --warning: #d29922;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 16px;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            flex-shrink: 0;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-section-title {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .folder-list {
            list-style: none;
        }

        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px 16px;
        }

        .tag-cloud-item {
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .tag-cloud-item:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
        }

        .tag-cloud-item.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #ffffff;
        }

        .tag-cloud-item .tag-count {
            font-size: 11px;
            background: rgba(0, 0, 0, 0.2);
            padding: 2px 6px;
            border-radius: 10px;
        }

        .todo-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 16px;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 6px;
            transition: all 0.15s ease;
        }

        .todo-item:hover {
            border-color: var(--accent);
        }

        .todo-item.completed {
            opacity: 0.6;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .todo-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .todo-content {
            flex: 1;
            min-width: 0;
        }

        .todo-text {
            font-size: 15px;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .todo-priority {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .todo-priority.high {
            background: var(--danger);
            color: #ffffff;
        }

        .todo-priority.medium {
            background: var(--warning);
            color: #0d1117;
        }

        .todo-priority.low {
            background: var(--success);
            color: #ffffff;
        }

        .todo-actions {
            display: flex;
            gap: 4px;
        }

        .todo-delete {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.15s ease;
        }

        .todo-delete:hover {
            background: var(--danger);
            color: #ffffff;
        }

        .sidebar-section {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-section-title {
            padding: 8px 16px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .folder-list {
            list-style: none;
        }

        .folder-item {
            padding: 10px 16px;
            cursor: pointer;
            border-left: 3px solid transparent;
            transition: all 0.15s ease;
            font-size: 15px;
            color: var(--text-secondary);
        }

        .folder-item:hover {
            background: var(--bg-tertiary);
        }

        .folder-item.active {
            border-left-color: var(--accent);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 500;
        }

        .folder-item .folder-color {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .controls {
            padding: 12px 16px;
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.15s ease;
        }

        .btn:hover {
            background: var(--bg-hover);
            border-color: var(--text-muted);
        }

        .btn.primary {
            background: var(--success);
            border-color: var(--success);
            color: #ffffff;
        }

        .btn.primary:hover {
            background: #2ea043;
            border-color: #2ea043;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: var(--bg-secondary);
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
        }

        .toolbar {
            background: var(--bg-secondary);
            padding: 12px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar-right {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        .search-box {
            padding: 8px 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 15px;
            width: 300px;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .filter-toggle:hover {
            background: var(--bg-hover);
        }

        .filter-toggle input[type="checkbox"] {
            margin: 0;
            cursor: pointer;
        }

        .filter-toggle.active {
            border-color: var(--accent);
            background: rgba(88, 166, 255, 0.1);
        }

        .tree-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
        }

        .tree-node {
            margin-left: 16px;
            padding: 4px 0;
        }

        .tree-root {
            margin-left: 0;
        }

        .node-content {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s ease;
            margin-bottom: 4px;
        }

        .node-content:hover {
            background: var(--bg-tertiary);
            border-color: var(--text-muted);
        }

        .node-content.selected {
            background: rgba(88, 166, 255, 0.1);
            border-color: var(--accent);
        }

        .node-content.prompt-node {
            border-left: 3px solid var(--accent);
        }

        .node-content.response-node {
            border-left: 3px solid var(--warning);
        }

        .node-content.user-node {
            border-left: 3px solid var(--success);
        }

        .node-content.system-node {
            border-left: 3px solid var(--text-muted);
        }

        .node-content.auto-node {
            border-left: 3px solid var(--accent);
            border-left-style: dashed;
        }

        .expand-icon {
            width: 20px;
            text-align: center;
            margin-right: 8px;
            cursor: pointer;
            user-select: none;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .node-checkbox {
            margin-right: 10px;
            cursor: pointer;
            width: 16px;
            height: 16px;
        }

        .node-content-wrapper {
            flex: 1;
            min-width: 0;
        }

        .node-header {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .node-type {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .node-type.prompt {
            background: var(--accent);
            color: #ffffff;
        }

        .node-type.response {
            background: var(--warning);
            color: #0d1117;
        }

        .node-type.user {
            background: var(--success);
            color: #ffffff;
        }

        .node-type.system {
            background: var(--text-muted);
            color: #ffffff;
        }

        .node-type.auto {
            background: var(--accent);
            color: #ffffff;
            opacity: 0.8;
        }

        .node-text {
            flex: 1;
            font-size: 15px;
            line-height: 1.5;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text-primary);
        }

        .node-meta {
            display: flex;
            gap: 12px;
            align-items: center;
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .node-folder {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .node-folder .folder-color {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .node-timestamp {
            flex-shrink: 0;
        }

        .editor-panel {
            width: 450px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
        }

        .editor-content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .editor-textarea {
            width: 100%;
            height: 300px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 15px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .editor-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .editor-actions {
            padding: 16px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 17, 23, 0.85);
            backdrop-filter: blur(4px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 24px;
            border: 1px solid var(--border);
            border-radius: 8px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .modal-header {
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            transition: color 0.15s ease;
        }

        .close-btn:hover {
            color: var(--text-primary);
        }

        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .color-option {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--text-primary);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            margin-bottom: 8px;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }

        .empty-state p {
            font-size: 13px;
            color: var(--text-muted);
        }

        .notification {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 6px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transform: translateY(100px);
            transition: transform 0.3s ease;
            z-index: 1000;
            font-size: 13px;
        }

        .notification.show {
            transform: translateY(0);
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-screen.hidden {
            display: none;
        }

        .loading-icon {
            font-size: 48px;
            margin-bottom: 16px;
            animation: spin 1s linear infinite;
            opacity: 0.6;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .loading-subtext {
            font-size: 13px;
            color: var(--text-muted);
        }

        .progress-bar {
            width: 300px;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }

        .dragging {
            opacity: 0.5;
            background: var(--bg-tertiary);
        }

        .drop-target {
            border: 2px dashed var(--accent);
            background: rgba(88, 166, 255, 0.05);
        }

        .drag-over {
            background: rgba(88, 166, 255, 0.1);
        }

        .combine-modal-content {
            width: 95%;
            max-width: 900px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .combine-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .combine-list-sidebar,
        .combine-preview-sidebar {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .combine-list-sidebar {
            width: 350px;
            border-right: 1px solid var(--border);
        }

        .combine-preview-sidebar {
            flex: 1;
        }

        .combine-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .combine-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 6px;
            cursor: move;
            transition: all 0.15s ease;
        }

        .combine-item:hover {
            border-color: var(--accent);
            background: var(--bg-tertiary);
        }

        .combine-item.combine-dragging {
            opacity: 0.5;
        }

        .combine-item.combine-dragover {
            border: 2px dashed var(--accent);
            background: rgba(88, 166, 255, 0.1);
        }

        .combine-item-drag {
            color: var(--text-muted);
            cursor: move;
            font-size: 14px;
            padding: 4px;
            user-select: none;
        }

        .combine-item-content {
            flex: 1;
            min-width: 0;
        }

        .combine-item-type {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: 600;
            margin-right: 8px;
        }

        .combine-item-type.prompt {
            background: var(--accent);
            color: #ffffff;
        }

        .combine-item-type.response {
            background: var(--warning);
            color: #0d1117;
        }

        .combine-item-text {
            font-size: 12px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .combine-item-remove {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.15s ease;
        }

        .combine-item-remove:hover {
            background: var(--danger);
            color: #ffffff;
        }

        .combine-actions {
            padding: 12px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 8px;
        }

        .combined-preview {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            margin: 8px 12px 12px;
        }

        .combined-preview:empty::before {
            content: 'Preview will appear here';
            color: var(--text-muted);
            font-style: italic;
        }

        .combined-preview h1,
        .combined-preview h2,
        .combined-preview h3,
        .combined-preview h4,
        .combined-preview h5,
        .combined-preview h6 {
            color: var(--text-primary);
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        .combined-preview h1 { font-size: 2em; }
        .combined-preview h2 { font-size: 1.5em; }
        .combined-preview h3 { font-size: 1.25em; }

        .combined-preview p {
            margin: 0.5em 0;
            line-height: 1.6;
            color: var(--text-primary);
            font-size: 16px;
        }

        .combined-preview code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
        }

        .combined-preview pre {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1em 0;
        }

        .combined-preview pre code {
            background: none;
            padding: 0;
        }

        .combined-preview blockquote {
            border-left: 3px solid var(--accent);
            padding-left: 16px;
            margin: 1em 0;
            color: var(--text-secondary);
        }

        .combined-preview ul,
        .combined-preview ol {
            margin: 0.5em 0;
            padding-left: 24px;
        }

        .combined-preview li {
            margin: 0.25em 0;
        }

        .combined-preview hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2em 0;
        }

        .combined-preview a {
            color: var(--accent);
            text-decoration: none;
        }

        .combined-preview a:hover {
            text-decoration: underline;
        }

        .combined-preview table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }

        .combined-preview th,
        .combined-preview td {
            border: 1px solid var(--border);
            padding: 8px 12px;
            text-align: left;
        }

        .combined-preview th {
            background: var(--bg-tertiary);
            font-weight: 600;
        }

        .optimize-modal {
            max-width: 700px;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .optimizer-section {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .optimizer-preview {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 15px;
            line-height: 1.6;
            max-height: 250px;
            min-height: 150px;
        }

        .optimizer-preview h1,
        .optimizer-preview h2,
        .optimizer-preview h3,
        .optimizer-preview h4,
        .optimizer-preview h5,
        .optimizer-preview h6 {
            font-size: 1.2em;
            margin: 0.75em 0;
            font-weight: 600;
        }

        .optimizer-preview p {
            margin: 0.5em 0;
        }

        .optimizer-preview code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 14px;
        }

        .optimizer-preview pre {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 0.5em 0;
        }

        .optimizer-preview pre code {
            background: none;
            padding: 0;
        }

        .agents-modal-content {
            width: 95%;
            max-width: 900px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .agents-preview {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 15px;
            line-height: 1.6;
            margin: 0 12px 12px;
            min-height: 300px;
        }

        .agents-preview h1,
        .agents-preview h2,
        .agents-preview h3,
        .agents-preview h4,
        .agents-preview h5,
        .agents-preview h6 {
            font-size: 1.3em;
            margin: 1em 0 0.5em;
            font-weight: 600;
        }

        .agents-preview h1 { font-size: 2em; }
        .agents-preview h2 { font-size: 1.5em; }
        .agents-preview h3 { font-size: 1.25em; }

        .agents-preview p {
            margin: 0.5em 0;
            line-height: 1.7;
        }

        .agents-preview code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 14px;
        }

        .agents-preview pre {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 0.75em 0;
        }

        .agents-preview pre code {
            background: none;
            padding: 0;
        }

        .agents-preview ul,
        .agents-preview ol {
            margin: 0.5em 0;
            padding-left: 24px;
        }

        .agents-preview li {
            margin: 0.3em 0;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-icon">⏳</div>
        <div class="loading-text" id="loadingText">Loading OpenChat messages...</div>
        <div class="loading-subtext" id="loadingSubtext">Please wait</div>
        <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="sidebar">
            <div class="sidebar-header">Folders</div>
            <div class="controls">
                <button class="btn primary" onclick="reloadData()">Reload</button>
                <button class="btn" onclick="showNewFolderModal()">New</button>
            </div>
            <ul class="folder-list" id="folderList">
                <li class="folder-item active" data-folder="all">
                    <div class="folder-name">All Messages</div>
                </li>
            </ul>

            <div class="sidebar-header" style="margin-top: 24px;">Tags</div>
            <div class="tag-cloud" id="tagCloud">
                <div class="tag-cloud-item" onclick="clearTagFilter()">Clear All</div>
            </div>

            <div class="sidebar-header" style="margin-top: 24px;">Todos</div>
            <div class="todo-list" id="todoList"></div>
            <div class="controls" style="padding: 0 16px 16px;">
                <input type="text" class="form-input" id="newTodoText" placeholder="Add todo..." style="width: 100%;">
                <button class="btn primary" onclick="addTodo()" style="width: 100%; margin-top: 8px;">Add</button>
            </div>
        </div>

        <div class="main-content">
            <div class="header">
                <div>
                    <h1>OC Message Explorer</h1>
                    <div class="header-subtitle">View and manage your OpenChat history</div>
                </div>
            </div>

            <div class="toolbar">
                <input type="text" class="search-box" id="searchBox" placeholder="Search messages..." oninput="filterMessages()">
                <label class="filter-toggle" id="searchToggle">
                    <input type="checkbox" id="searchRawOnly" onchange="toggleSearchMode()">
                    <span>Raw only</span>
                </label>
                <label class="filter-toggle" id="filterToggle">
                    <input type="checkbox" id="userOnlyFilter" onchange="toggleUserFilter()">
                    <span>User only</span>
                </label>
                <label class="filter-toggle" id="displayToggle">
                    <input type="checkbox" id="displayRawMessages" onchange="toggleDisplayMode()">
                    <span>Show raw</span>
                </label>
                <label class="filter-toggle" id="sortToggle">
                    <input type="checkbox" id="sortAscending" checked onchange="toggleSortOrder()">
                    <span>Newest first</span>
                </label>
                <input type="date" class="form-input" id="startDate" style="width: 150px;" title="Start date">
                <input type="date" class="form-input" id="endDate" style="width: 150px;" title="End date">
                <button class="btn primary" onclick="showNewMessageModal('prompt')">New Prompt</button>
                <div class="toolbar-right">
                    <button class="btn" onclick="copySelected()">Copy</button>
                    <button class="btn" onclick="showCombineModal()">Combine</button>
                    <button class="btn" onclick="showSettingsModal()">Settings</button>
                    <button class="btn" onclick="exportData()">Export</button>
                    <button class="btn" onclick="document.getElementById('importFile').click()">Import</button>
                    <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(event)">
                    <button class="btn" onclick="expandAll()">Expand</button>
                    <button class="btn" onclick="collapseAll()">Collapse</button>
                </div>
            </div>

            <div class="tree-container" id="treeContainer">
                <div class="empty-state">
                    <h3>No messages</h3>
                    <p>Reload to load your OpenChat history</p>
                </div>
            </div>
        </div>

        <div class="editor-panel" id="editorPanel" style="display: none;">
            <div class="editor-header">
                Editor
                <button class="close-btn" onclick="closeEditor()">✕</button>
            </div>
            <div class="editor-content">
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="nodeType">
                        <option value="user">User</option>
                        <option value="auto">Auto-Generated</option>
                        <option value="system">System</option>
                        <option value="prompt">Prompt</option>
                        <option value="response">Response</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Raw Message (what you typed)</label>
                    <textarea class="editor-textarea" id="nodeContent" placeholder="Your actual message..." style="height: 200px;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">AI Summary (tool output)</label>
                    <textarea class="editor-textarea" id="nodeSummary" placeholder="Tool summary..." style="height: 150px;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Tags (comma-separated)</label>
                    <input type="text" class="form-input" id="nodeTags" placeholder="tag1, tag2, tag3">
                </div>
            </div>
            <div class="editor-actions">
                <button class="btn primary" onclick="saveNode()">Save</button>
                <button class="btn" onclick="deleteNode()">Delete</button>
            </div>
        </div>
    </div>

    <div class="modal" id="newFolderModal">
        <div class="modal-content">
            <div class="modal-header">
                New Folder
                <button class="close-btn" onclick="hideModal('newFolderModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Folder Name</label>
                <input type="text" class="form-input" id="folderName" placeholder="My Folder">
            </div>
            <div class="form-group">
                <label class="form-label">Color</label>
                <div class="color-picker" id="folderColorPicker">
                    <div class="color-option selected" style="background: #58a6ff;" data-color="#58a6ff"></div>
                    <div class="color-option" style="background: #238636;" data-color="#238636"></div>
                    <div class="color-option" style="background: #d29922;" data-color="#d29922"></div>
                    <div class="color-option" style="background: #da3633;" data-color="#da3633"></div>
                    <div class="color-option" style="background: #a371f7;" data-color="#a371f7"></div>
                    <div class="color-option" style="background: #f0883e;" data-color="#f0883e"></div>
                </div>
            </div>
            <div class="editor-actions">
                <button class="btn primary" onclick="createFolder()">Create</button>
            </div>
        </div>
    </div>

    <div class="modal" id="newMessageModal">
        <div class="modal-content">
            <div class="modal-header">
                New Message
                <button class="close-btn" onclick="hideModal('newMessageModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Parent Message</label>
                <select class="form-select" id="parentMessageSelect">
                    <option value="">None (root message)</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Content</label>
                <textarea class="editor-textarea" id="newMessageContent" placeholder="Enter your content..." style="height: 150px;"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Tags (comma-separated)</label>
                <input type="text" class="form-input" id="newMessageTags" placeholder="tag1, tag2, tag3">
            </div>
            <div class="editor-actions">
                <button class="btn primary" onclick="createMessage()">Create</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <div class="modal" id="combineModal">
        <div class="modal-content combine-modal-content">
            <div class="modal-header">
                Combine Messages
                <button class="close-btn" onclick="hideModal('combineModal')">&times;</button>
            </div>
            <div class="combine-container">
                <div class="combine-list-sidebar">
                    <div class="sidebar-header">Order</div>
                    <div id="combineList" class="combine-list"></div>
                    <div class="combine-actions">
                        <button class="btn primary" onclick="copyCombined()">Copy Combined</button>
                        <button class="btn" onclick="optimizeCombinedPrompts()">Optimize with AI</button>
                    </div>
                </div>
                <div class="combine-preview-sidebar">
                    <div class="sidebar-header">Preview</div>
                    <div id="combinedPreview" class="combined-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content" style="max-width: 650px; max-height: 90vh; overflow-y: auto; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0;">
                Settings
                <button class="close-btn" onclick="hideModal('settingsModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">OpenAI API Key</label>
                <input type="password" class="form-input" id="openaiApiKey" placeholder="sk-...">
                <small style="color: var(--text-muted); font-size: 13px; margin-top: 6px; display: block;">Your API key is stored locally only and in .env file</small>
            </div>
            <div class="form-group">
                <label class="form-label">OpenAI Base URL (optional)</label>
                <input type="text" class="form-input" id="openaiBaseUrl" placeholder="https://api.openai.com/v1">
                <small style="color: var(--text-muted); font-size: 13px; margin-top: 6px; display: block;">Custom OpenAI-compatible API endpoint (leave blank for default)</small>
            </div>
            <div class="form-group" id="modelSelectGroup" style="display: none;">
                <label class="form-label">Model</label>
                <select class="form-select" id="openaiModel">
                    <option value="">Select a model</option>
                </select>
                <button class="btn" onclick="fetchModels()" style="margin-top: 8px;">Refresh Models</button>
            </div>
            <div class="form-group">
                <label class="form-label">Optimization Prompt</label>
                <textarea class="editor-textarea" id="optimizationPrompt" style="height: 180px;" placeholder="Custom prompt for optimization...">First, read and understand the AGENTS.md file which contains project-specific guidelines, coding conventions, and development practices. 

Then, combine these prompts into a single, task-oriented prompt that will direct you to:

1. Verify the existence of the components described in the prompts within the project codebase
2. If any component does not exist, recreate it following the guidelines from AGENTS.md
3. Ensure all code follows the project's coding conventions and best practices
4. Maintain consistency with the existing project structure and patterns

Base your implementation decisions on the guidance in AGENTS.md, prioritizing:
- Code quality and maintainability
- Adherence to project conventions
- Proper documentation and commenting
- Type safety and error handling</textarea>
                <small style="color: var(--text-muted); font-size: 13px; margin-top: 6px; display: block;">
                    This prompt is used to combine multiple selected prompts into a single task-oriented prompt for verification and recreation of project components.
                </small>
            </div>
            <div class="form-group">
                <label class="form-label">Project Path</label>
                <input type="text" class="form-input" id="projectPath" placeholder="Path to project directory">
                <small style="color: var(--text-muted); font-size: 13px; margin-top: 6px; display: block;">
                    Absolute or relative path to the project directory. Used for reading AGENTS.md.
                </small>
            </div>
            <div class="form-group">
                <label class="form-label">AGENTS.md Path</label>
                <input type="text" class="form-input" id="agentsPath" placeholder="Path to AGENTS.md">
                <small style="color: var(--text-muted); font-size: 13px; margin-top: 6px; display: block;">
                    Path to AGENTS.md file. Can be relative to project path or absolute.
                </small>
            </div>
            <div class="editor-actions">
                <button class="btn primary" onclick="saveSettings()">Save to .env</button>
                <button class="btn" onclick="testApiKey()">Test Connection</button>
                <button class="btn" onclick="loadAgentsContent()">View AGENTS.md</button>
            </div>
        </div>
    </div>

    <div class="modal" id="optimizeModal">
        <div class="modal-content optimize-modal" style="width: 700px;">
            <div class="modal-header">
                Optimize Prompts
                <button class="close-btn" onclick="hideModal('optimizeModal')">&times;</button>
            </div>
            <div class="optimizer-section">
                <label class="form-label">Combined Text</label>
                <div class="optimizer-preview" id="optimizerPreview"></div>
            </div>
            <div class="form-group">
                <label class="form-label">Optimized Result</label>
                <div class="optimizer-preview" id="optimizerResult">
                    <div style="color: var(--text-muted); text-align: center; padding: 40px;">
                        Click "Optimize" to generate an optimized version
                    </div>
                </div>
            </div>
            <div class="editor-actions">
                <button class="btn primary" onclick="optimizePrompts()">Optimize</button>
                <button class="btn" onclick="copyOptimizedResult()" id="copyOptimizedBtn" style="display: none;">Copy Result</button>
            </div>
        </div>
    </div>

    <div class="modal" id="agentsContentModal">
        <div class="modal-content agents-modal-content">
            <div class="modal-header">
                AGENTS.md Content
                <button class="close-btn" onclick="hideModal('agentsContentModal')">&times;</button>
            </div>
            <div class="agents-preview" id="agentsPreview">
                <div style="color: var(--text-muted); text-align: center; padding: 40px;">Loading...</div>
            </div>
            <div class="editor-actions">
                <button class="btn primary" onclick="copyAgentsContent()">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script src="/static/marked.min.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
